#!/bin/sh

rm -rf target > /dev/null 2>&1

. src/bash/maven.functions

mkdir -p target/src

cp src/main/ArtifactDownloader.java src/main/HttpUtils.java target/src

compile . target/classes target/src

runJava target/classes ArtifactDownloader junit/jars/junit-3.8.1.jar
runJava target/classes ArtifactDownloader maven/jars/surefire-runner-1.0.jar
runJava target/classes ArtifactDownloader plexus/jars/plexus-utils-1.0-beta-1.jar

repoLocal=`cat bootstrap.repo`

if $cygwin = true; then
  repoLocal=`cygpath -pu "$repoLocal"`
fi

compile ".:$repoLocal/junit/jars/junit-3.8.1.jar:$repoLocal/maven/jars/surefire-runner-1.0.jar:$repoLocal/plexus/jars/plexus-utils-1.0-beta-1.jar" target/classes src/main

isCommandSuccessful $? "Failed compiling Maven bootstrapper classes!"

DIST=target/mboot

mkdir -p $DIST

cp -r target/classes $DIST

cp src/bash/* $DIST

(
  cd target/mboot
  
  tar cvzf ../mboot.tar.gz *
)

cat src/sea/sea-header target/mboot.tar.gz > target/mboot-install.sh
  
chmod +x target/mboot-install.sh

rm -f bootstrap.repo > /dev/null 2>&1
